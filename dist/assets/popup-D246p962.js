import{g as _,h as $,i as F,j as L,k as U,m as G,S as V,az as D,a9 as w,x as r,ac as d,X as n,ad as z,I as q,w as E,P as f,aB as N,ag as v,aa as X,aq as Y,ai as J,aj as K,ak as M,al as b,am as Q,aA as Z,ay as ee}from"./index-DHU7bg4n.js";import{r as p,j as e}from"./vendor-motion-BQO2KiUE.js";import{q as te,a as ae,X as re,b as ie,i as oe,r as ne,d as se}from"./vendor-icons-CGejAD0Y.js";import"./vendor-react-DJG_os-6.js";function le(o){return _("MuiTableContainer",o)}$("MuiTableContainer",["root"]);const ce=o=>{const{classes:t}=o;return G({root:["root"]},le,t)},de=L("div",{name:"MuiTableContainer",slot:"Root",overridesResolver:(o,t)=>t.root})({width:"100%",overflowX:"auto"}),pe=p.forwardRef(function(t,x){const l=F({props:t,name:"MuiTableContainer"}),{className:u,component:h="div",...m}=l,g={...l,component:h},a=ce(g);return e.jsx(de,{ref:x,as:h,className:U(a.root,u),ownerState:g,...m})}),H=[{skill:"RSFVAF",preference:"5",efficiency:"—",group:"Group B"},{skill:"RFJBAS",preference:"10",efficiency:"—",group:"Group B"},{skill:"RBTFC1",preference:"1",efficiency:"—",group:"Group B"},{skill:"SDRIVE",preference:"4",efficiency:"—",group:"Group A"},{skill:"SVEHW",preference:"4",efficiency:"—",group:"Group A"}];function P(o){if(!o)return"";const t=new Date(o);if(Number.isNaN(t.getTime()))return"";const x=String(t.getDate()).padStart(2,"0"),l=String(t.getMonth()+1).padStart(2,"0"),u=t.getFullYear(),h=String(t.getHours()).padStart(2,"0"),m=String(t.getMinutes()).padStart(2,"0");return`${x}/${l}/${u} ${h}:${m}`}function xe(o,t){switch(t.trim().split(" ").pop()??""){case"A":return{color:r(o.palette.primary.main,.95),bgcolor:r(o.palette.primary.main,.12),borderColor:r(o.palette.primary.main,.35)};case"B":return{color:r(o.palette.success.dark,.95),bgcolor:r(o.palette.success.light,.2),borderColor:r(o.palette.success.main,.35)};case"C":return{color:r(o.palette.warning.dark,.95),bgcolor:r(o.palette.warning.light,.25),borderColor:r(o.palette.warning.main,.35)};default:return{color:r(o.palette.text.primary,.8),bgcolor:r(o.palette.text.primary,.08),borderColor:r(o.palette.text.primary,.18)}}}function ue({open:o,resource:t,history:x,expanded:l,onToggleSection:u,onExpandAll:h,onCollapseAll:m,onClose:g}){var S;const a=V(),[y,I]=p.useState(""),k=p.useMemo(()=>{if(!y.trim())return H;const i=y.trim().toLowerCase();return H.filter(s=>[s.skill,s.preference,s.group].join(" ").toLowerCase().includes(i))},[y]),R=p.useMemo(()=>[...x].sort((i,s)=>{const j=Date.parse(i.timestamp),A=Date.parse(s.timestamp);return!Number.isNaN(j)&&!Number.isNaN(A)?A-j:Number.isNaN(j)?Number.isNaN(A)?0:1:-1}),[x]);if(!o)return null;const T=[{label:"Resource ID",value:t.resourceId},{label:"Name",value:t.name},{label:"Division",value:t.division},{label:"Callout Group",value:t.calloutGroup},{label:"Primary Skill",value:t.primarySkill},{label:"Secondary Skill",value:t.secondarySkill},{label:"Patch (PWA)",value:t.pwa},{label:"Dispatch Mode",value:t.dispatchMode}],c=[{label:"Current Status",value:t.status},{label:"Last Outcome",value:t.lastOutcome?((S=D[t.lastOutcome])==null?void 0:S.label)??String(t.lastOutcome):""},{label:"Available Again",value:t.availableAgainAt?P(t.availableAgainAt):""},{label:"Last Updated",value:t.updatedAt?P(t.updatedAt):""}],C=[{label:"Contact Number",value:t.contactNumber},{label:"Notes",value:t.notes}];return e.jsx(w,{sx:{display:"flex",height:"100%",width:"100%",bgcolor:r(a.palette.primary.main,.06),color:"text.primary",overflow:"hidden"},children:e.jsxs(d,{sx:{flex:1,bgcolor:a.palette.background.paper,overflow:"hidden"},children:[e.jsxs(w,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",px:{xs:3,md:6},py:3,borderBottom:`1px solid ${r(a.palette.primary.main,.12)}`,bgcolor:r(a.palette.background.paper,.96),backdropFilter:"blur(6px)"},children:[e.jsxs(d,{spacing:.5,children:[e.jsx(n,{variant:"h6",fontWeight:600,color:"text.primary",children:"Resource Details"}),e.jsx(n,{variant:"caption",color:"text.secondary",children:"Explore current status, contact details, and callout history."})]}),e.jsxs(d,{direction:"row",spacing:1.5,alignItems:"center",children:[e.jsx(z,{variant:"contained",color:"primary",size:"small",onClick:()=>l.length?m():h(),startIcon:l.length?e.jsx(te,{size:14}):e.jsx(ae,{size:14}),sx:{textTransform:"none",fontWeight:600,px:2.5},children:l.length?"Collapse All":"Expand All"}),e.jsx(z,{variant:"outlined",color:"primary",size:"small",sx:{textTransform:"none",fontWeight:600},children:"Edit"}),e.jsx(q,{size:"small",onClick:g,sx:{color:r(a.palette.text.primary,.6),"&:hover":{color:a.palette.primary.main}},"aria-label":"Close resource panel",children:e.jsx(re,{size:16})})]})]}),e.jsx(w,{sx:{px:{xs:3,md:6},py:2,borderBottom:`1px solid ${r(a.palette.primary.main,.1)}`,bgcolor:r(a.palette.primary.main,.04)},children:e.jsxs(d,{direction:"row",spacing:1.5,flexWrap:"wrap",alignItems:"center",children:[e.jsx(E,{label:t.resourceId,size:"small",sx:{fontWeight:700,letterSpacing:.6,textTransform:"uppercase",color:a.palette.primary.main,borderColor:r(a.palette.primary.main,.4),bgcolor:r(a.palette.primary.main,.16)},variant:"outlined"}),t.name&&e.jsx(E,{label:t.name,size:"small",variant:"outlined",sx:{color:r(a.palette.text.primary,.85),borderColor:r(a.palette.text.primary,.2),bgcolor:a.palette.background.paper}})]})}),e.jsx(w,{sx:{flex:1,px:{xs:2.5,md:6},py:{xs:3,md:5},bgcolor:r(a.palette.primary.main,.02),overflowY:"auto"},children:e.jsx(w,{sx:{display:"flex",justifyContent:"center",pb:3},children:e.jsx(f,{elevation:10,sx:{width:{xs:"100%",sm:"min(100%, 720px)"},borderRadius:3,border:`1px solid ${r(a.palette.primary.main,.14)}`,boxShadow:"0 24px 48px rgba(8,58,97,0.18)",bgcolor:r(a.palette.background.paper,.98),px:{xs:3,md:4},py:{xs:3,md:4}},children:e.jsxs(d,{spacing:3,children:[e.jsx(N,{title:"Resource Summary",expanded:l.includes("Resource Summary"),onToggle:()=>u("Resource Summary"),children:e.jsxs(d,{spacing:3,children:[e.jsxs(d,{direction:{xs:"column",sm:"row"},spacing:2,justifyContent:"space-between",alignItems:{xs:"flex-start",sm:"center"},children:[e.jsxs(d,{spacing:.5,children:[e.jsx(n,{variant:"subtitle1",fontWeight:600,color:"text.primary",children:t.name||"—"}),e.jsx(n,{variant:"body2",color:"text.secondary",children:t.resourceId})]}),e.jsx(z,{variant:"outlined",size:"small",startIcon:e.jsx(ie,{size:14}),onClick:()=>navigator.clipboard.writeText(t.resourceId),sx:{textTransform:"none",fontWeight:600},children:"Copy ID"})]}),e.jsx(v,{container:!0,spacing:2.5,children:T.map(({label:i,value:s})=>e.jsxs(v,{item:!0,xs:12,sm:6,children:[e.jsx(n,{variant:"overline",sx:{letterSpacing:1.2,fontWeight:600,color:r(a.palette.text.secondary,.9)},children:i}),e.jsx(n,{variant:"body2",color:"text.primary",children:s||"—"})]},i))})]})},"Resource Summary"),e.jsx(N,{title:"Availability & Contact",expanded:l.includes("Availability"),onToggle:()=>u("Availability"),children:e.jsxs(d,{spacing:3,children:[e.jsx(v,{container:!0,spacing:2.5,children:c.map(({label:i,value:s})=>e.jsx(v,{item:!0,xs:12,sm:6,children:e.jsxs(f,{variant:"outlined",sx:{px:2.5,py:2,borderRadius:2,borderColor:r(a.palette.primary.main,.1),bgcolor:r(a.palette.primary.main,.04)},children:[e.jsx(n,{variant:"overline",sx:{letterSpacing:1.1,color:r(a.palette.text.secondary,.9)},children:i}),e.jsx(n,{variant:"body2",color:"text.primary",children:s||"—"})]})},i))}),e.jsxs(v,{container:!0,spacing:2.5,children:[C.map(({label:i,value:s})=>e.jsx(v,{item:!0,xs:12,sm:6,children:e.jsxs(f,{variant:"outlined",sx:{px:2.5,py:2,borderRadius:2,borderColor:r(a.palette.primary.main,.1)},children:[e.jsx(n,{variant:"overline",sx:{letterSpacing:1.1,color:r(a.palette.text.secondary,.9)},children:i}),e.jsx(n,{variant:"body2",color:"text.primary",children:s||"—"})]})},i)),e.jsx(v,{item:!0,xs:12,sm:6,children:e.jsxs(f,{variant:"outlined",sx:{px:2.5,py:2,borderRadius:2,display:"flex",alignItems:"flex-start",gap:1.5,borderColor:r(a.palette.primary.main,.12)},children:[e.jsx(oe,{size:18,color:a.palette.primary.main}),e.jsxs(w,{children:[e.jsx(n,{variant:"overline",sx:{letterSpacing:1.1,color:r(a.palette.text.secondary,.9)},children:"Sign-on"}),e.jsx(n,{variant:"body2",color:"text.primary",children:t.signOn||"—"})]})]})}),e.jsx(v,{item:!0,xs:12,sm:6,children:e.jsxs(f,{variant:"outlined",sx:{px:2.5,py:2,borderRadius:2,display:"flex",alignItems:"flex-start",gap:1.5,borderColor:r(a.palette.primary.main,.12)},children:[e.jsx(ne,{size:18,color:a.palette.primary.main}),e.jsxs(w,{children:[e.jsx(n,{variant:"overline",sx:{letterSpacing:1.1,color:r(a.palette.text.secondary,.9)},children:"Home Postcode"}),e.jsx(n,{variant:"body2",color:"text.primary",children:t.homePostCode||"—"})]})]})})]})]})},"Availability"),e.jsx(N,{title:"Callout History",expanded:l.includes("Callout History"),onToggle:()=>u("Callout History"),children:e.jsxs(d,{spacing:2.5,sx:{maxHeight:a.spacing(40),overflowY:"auto",pr:1},children:[R.length===0&&e.jsx(f,{variant:"outlined",sx:{borderRadius:2,borderStyle:"dashed",borderColor:r(a.palette.primary.main,.25),bgcolor:r(a.palette.primary.main,.05),textAlign:"center",px:3,py:4},children:e.jsx(n,{variant:"body2",color:"text.secondary",children:"No history recorded for this resource yet."})}),R.map(i=>{var j;const s=i.outcome&&typeof i.outcome=="string"&&((j=D[i.outcome])==null?void 0:j.label)||String(i.outcome??"");return e.jsxs(f,{variant:"outlined",sx:{borderRadius:2,borderColor:r(a.palette.primary.main,.12),px:2.5,py:2,boxShadow:"0 10px 24px rgba(8,58,97,0.08)",bgcolor:a.palette.background.paper},children:[e.jsxs(d,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsx(n,{variant:"body2",fontWeight:600,color:"text.primary",children:s||"Outcome"}),e.jsx(n,{variant:"caption",color:"text.secondary",children:P(i.timestamp)||"—"})]}),i.note&&e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mt:1.5,lineHeight:1.6},children:i.note}),i.availableAgainAt&&e.jsxs(n,{variant:"caption",color:"text.secondary",sx:{mt:1.5,display:"block"},children:["Return ",P(i.availableAgainAt)]}),e.jsx(n,{variant:"overline",sx:{mt:2,letterSpacing:1,color:r(a.palette.text.secondary,.7)},children:i.status||""})]},i.id)})]})},"Callout History"),e.jsx(N,{title:"Capabilities",expanded:l.includes("Capabilities"),onToggle:()=>u("Capabilities"),children:e.jsxs(d,{spacing:3,children:[e.jsx(X,{value:y,onChange:i=>I(i.target.value),placeholder:"Filter by skill, preference, or group…",size:"small",InputProps:{startAdornment:e.jsx(Y,{position:"start",children:e.jsx(se,{size:16,color:r(a.palette.text.secondary,.7)})}),sx:{borderRadius:2,"& .MuiOutlinedInput-notchedOutline":{borderColor:r(a.palette.primary.main,.22)},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:r(a.palette.primary.main,.45)}}}}),e.jsx(pe,{component:f,variant:"outlined",sx:{maxHeight:a.spacing(35),borderRadius:2,borderColor:r(a.palette.primary.main,.12)},children:e.jsxs(J,{size:"small",stickyHeader:!0,children:[e.jsx(K,{children:e.jsxs(M,{children:[e.jsx(b,{children:"Skill"}),e.jsx(b,{children:"Preference"}),e.jsx(b,{children:"Efficiency"}),e.jsx(b,{children:"Group"})]})}),e.jsx(Q,{children:k.length===0?e.jsx(M,{children:e.jsx(b,{colSpan:4,align:"center",sx:{py:4,color:"text.secondary"},children:"No matching capability entries."})}):k.map(i=>e.jsxs(M,{hover:!0,children:[e.jsx(b,{sx:{fontWeight:600},children:i.skill}),e.jsx(b,{children:i.preference}),e.jsx(b,{children:i.efficiency}),e.jsx(b,{children:e.jsx(E,{label:i.group,size:"small",variant:"outlined",sx:{borderRadius:999,fontWeight:600,px:1,...xe(a,i.group)}})})]},`${i.skill}-${i.group}`))})]})})]})},"Capabilities")]})})})})]})})}function me(){const o=window.__POPUP_DATA__;if(!o)return e.jsx("div",{className:"p-10 text-center text-gray-500",children:"Loading popup…"});const t=o.mode==="tasks",x=t?o.tasks:[],l=t?null:o.resource,u=t?[]:o.history??[],[h,m]=p.useState(o.expanded??[]),[g,a]=p.useState(1),[y,I]=p.useState(()=>({width:typeof window>"u"?0:window.innerWidth,height:typeof window>"u"?0:window.innerHeight}));p.useEffect(()=>{const c=()=>{const s=window.innerHeight,j=window.innerWidth,A=s*.01;document.documentElement.style.setProperty("--vh",`${A}px`);const O=Math.max(.75,Math.min(1,s/900)),B=Number(O.toFixed(2));a(B),document.documentElement.style.setProperty("--ui-scale",String(O));const W=Math.max(13,Math.min(16,Math.round(s/60)));document.documentElement.style.fontSize=`${W}px`,I({width:j,height:s})},C=document.body.style.margin,S=document.body.style.backgroundColor,i=document.body.style.overflow;return document.body.style.margin="0",document.body.style.backgroundColor="#F5F7FA",document.body.style.overflow="hidden",c(),window.addEventListener("resize",c),()=>{window.removeEventListener("resize",c),document.body.style.margin=C,document.body.style.backgroundColor=S,document.body.style.overflow=i}},[]);const k=p.useCallback(c=>{m(C=>C.includes(c)?C.filter(S=>S!==c):[...C,c])},[]),R=p.useCallback(()=>{m(["Work Details","Commitments / Customer / Location","Scheduling / Resources","Access Restrictions","Job Notes","Progress Notes","Closure"])},[]),T=p.useCallback(()=>{m([])},[]);return e.jsxs("div",{className:"min-h-screen w-screen overflow-hidden",style:{height:y.height===0?"100%":`${y.height/g}px`,width:y.width===0?"100%":`${y.width/g}px`,transform:`scale(${g})`,transformOrigin:"top left"},children:[t&&e.jsx(ee,{open:!0,tasks:x,expanded:h,onToggleSection:k,onExpandAll:R,onCollapseAll:T,onClose:()=>{var c;return(c=window.__POPUP_CLOSE__)==null?void 0:c.call(window)}}),!t&&l&&e.jsx(ue,{open:!0,resource:l,history:u,expanded:h,onToggleSection:k,onExpandAll:()=>{m(["Resource Summary","Availability","Callout History","Capabilities"])},onCollapseAll:T,onClose:()=>{var c;return(c=window.__POPUP_CLOSE__)==null?void 0:c.call(window)}})]})}Z.createRoot(document.getElementById("popup-root")).render(e.jsx(me,{}));
