import{a as C,R as S,T as P}from"./index-DSw47wa6.js";import{r as n,j as e}from"./vendor-motion-BQO2KiUE.js";import{r as f,a as j,c as E,i as R,s as z,d as D}from"./vendor-icons-Chnu0C9F.js";import"./vendor-react-DJG_os-6.js";const k=[{skill:"RSFVAF",preference:"5",efficiency:"—",group:"Group B"},{skill:"RFJBAS",preference:"10",efficiency:"—",group:"Group B"},{skill:"RBTFC1",preference:"1",efficiency:"—",group:"Group B"},{skill:"SDRIVE",preference:"4",efficiency:"—",group:"Group A"},{skill:"SVEHW",preference:"4",efficiency:"—",group:"Group A"}];function w(i){if(!i)return"";const t=new Date(i);if(Number.isNaN(t.getTime()))return"";const m=String(t.getDate()).padStart(2,"0"),r=String(t.getMonth()+1).padStart(2,"0"),o=t.getFullYear(),u=String(t.getHours()).padStart(2,"0"),c=String(t.getMinutes()).padStart(2,"0");return`${m}/${r}/${o} ${u}:${c}`}function F(i){switch(i.trim().split(" ").pop()??""){case"A":return"bg-blue-100 text-blue-800 border-blue-200";case"B":return"bg-emerald-100 text-emerald-800 border-emerald-200";case"C":return"bg-amber-100 text-amber-800 border-amber-200";default:return"bg-gray-100 text-gray-700 border-gray-200"}}function M({open:i,resource:t,history:m,expanded:r,onToggleSection:o,onExpandAll:u,onCollapseAll:c,onClose:g}){var A;const[p,v]=n.useState(""),N=n.useMemo(()=>{if(!p.trim())return k;const s=p.trim().toLowerCase();return k.filter(a=>[a.skill,a.preference,a.group].join(" ").toLowerCase().includes(s))},[p]),y=n.useMemo(()=>[...m].sort((s,a)=>{const d=Date.parse(s.timestamp),h=Date.parse(a.timestamp);return!Number.isNaN(d)&&!Number.isNaN(h)?h-d:Number.isNaN(d)?Number.isNaN(h)?0:1:-1}),[m]);if(!i)return null;const l=[{label:"Resource ID",value:t.resourceId},{label:"Name",value:t.name},{label:"Division",value:t.division},{label:"Callout Group",value:t.calloutGroup},{label:"Primary Skill",value:t.primarySkill},{label:"Secondary Skill",value:t.secondarySkill},{label:"Patch (PWA)",value:t.pwa},{label:"Dispatch Mode",value:t.dispatchMode}],x=[{label:"Current Status",value:t.status},{label:"Last Outcome",value:t.lastOutcome?((A=C[t.lastOutcome])==null?void 0:A.label)??String(t.lastOutcome):""},{label:"Available Again",value:t.availableAgainAt?w(t.availableAgainAt):""},{label:"Last Updated",value:t.updatedAt?w(t.updatedAt):""}],b=[{label:"Contact Number",value:t.contactNumber},{label:"Notes",value:t.notes}];return e.jsx("div",{className:"flex h-full w-full bg-[#F5F7FA] text-gray-900",children:e.jsxs("div",{className:"flex h-full w-full flex-col overflow-hidden bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 bg-white border-b border-gray-200",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:"Resource Details"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Explore current status, contact details, and callout history."})]}),e.jsx("button",{onClick:()=>r.length?c():u(),className:"px-3 py-1.5 rounded-md text-sm flex items-center gap-2 bg-[#0A4A7A] text-white shadow-sm transition hover:bg-[#0C5A97]",children:r.length?e.jsxs(e.Fragment,{children:[e.jsx(f,{size:14})," Collapse All"]}):e.jsxs(e.Fragment,{children:[e.jsx(j,{size:14})," Expand All"]})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-6 py-6 space-y-5 bg-gray-50",children:[e.jsxs("section",{className:"bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden",children:[e.jsxs("button",{onClick:()=>o("Resource Summary"),className:"w-full flex justify-between items-center px-5 py-3 text-left font-medium text-gray-900 hover:bg-gray-50",children:["Resource Summary",r.includes("Resource Summary")?e.jsx(f,{size:18}):e.jsx(j,{size:18})]}),r.includes("Resource Summary")&&e.jsxs("div",{className:"px-5 py-4 border-t border-gray-100 text-sm text-gray-700 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:t.name}),e.jsx("p",{className:"text-sm text-gray-500",children:t.resourceId})]}),e.jsxs("button",{onClick:()=>navigator.clipboard.writeText(t.resourceId),className:"inline-flex items-center gap-1 text-xs px-3 py-1.5 border border-[#0A4A7A]/30 text-[#0A4A7A] rounded-md hover:bg-[#0A4A7A]/10",children:[e.jsx(E,{size:12})," Copy ID"]})]}),e.jsx("dl",{className:"grid grid-cols-2 gap-x-6 gap-y-3",children:l.map(({label:s,value:a})=>e.jsxs("div",{children:[e.jsx("dt",{className:"text-[11px] uppercase tracking-wide text-gray-400",children:s}),e.jsx("dd",{className:"text-sm text-gray-800",children:a||"—"})]},s))})]})]}),e.jsxs("section",{className:"bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden",children:[e.jsxs("button",{onClick:()=>o("Availability"),className:"w-full flex justify-between items-center px-5 py-3 text-left font-medium text-gray-900 hover:bg-gray-50",children:["Availability & Contact",r.includes("Availability")?e.jsx(f,{size:18}):e.jsx(j,{size:18})]}),r.includes("Availability")&&e.jsxs("div",{className:"px-5 py-4 border-t border-gray-100 text-sm text-gray-700 space-y-5",children:[e.jsx("div",{className:"grid grid-cols-2 gap-4",children:x.map(({label:s,value:a})=>e.jsxs("div",{className:"rounded-lg border border-gray-200 bg-gray-50 px-4 py-3",children:[e.jsx("span",{className:"text-[11px] uppercase tracking-wide text-gray-400",children:s}),e.jsx("div",{className:"mt-1 text-sm text-gray-800",children:a||"—"})]},s))}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[b.map(({label:s,value:a})=>e.jsxs("div",{className:"rounded-lg border border-gray-200 px-4 py-3",children:[e.jsx("span",{className:"text-[11px] uppercase tracking-wide text-gray-400",children:s}),e.jsx("div",{className:"mt-1 text-sm text-gray-800",children:a||"—"})]},s)),e.jsxs("div",{className:"rounded-lg border border-gray-200 px-4 py-3 flex items-center gap-3 text-sm text-gray-700",children:[e.jsx(R,{size:16,className:"text-[#0A4A7A]"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] uppercase tracking-wide text-gray-400",children:"Sign-on"}),e.jsx("div",{children:t.signOn||"—"})]})]}),e.jsxs("div",{className:"rounded-lg border border-gray-200 px-4 py-3 flex items-center gap-3 text-sm text-gray-700",children:[e.jsx(z,{size:16,className:"text-[#0A4A7A]"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-[11px] uppercase tracking-wide text-gray-400",children:"Home Postcode"}),e.jsx("div",{children:t.homePostCode||"—"})]})]})]})]})]}),e.jsxs("section",{className:"bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden",children:[e.jsxs("button",{onClick:()=>o("Callout History"),className:"w-full flex justify-between items-center px-5 py-3 text-left font-medium text-gray-900 hover:bg-gray-50",children:["Callout History",r.includes("Callout History")?e.jsx(f,{size:18}):e.jsx(j,{size:18})]}),r.includes("Callout History")&&e.jsxs("div",{className:"px-5 py-4 border-t border-gray-100 space-y-3 max-h-[360px] overflow-y-auto",children:[y.length===0&&e.jsx("div",{className:"text-sm text-gray-500 bg-gray-50 border border-dashed border-gray-300 rounded-lg px-4 py-6 text-center",children:"No history recorded for this resource yet."}),y.map(s=>{var d;const a=s.outcome&&typeof s.outcome=="string"&&((d=C[s.outcome])==null?void 0:d.label)||String(s.outcome??"");return e.jsxs("div",{className:"border border-gray-200 rounded-lg px-4 py-3 bg-white shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:a||"Outcome"}),e.jsx("span",{children:w(s.timestamp)||"—"})]}),s.note&&e.jsx("p",{className:"mt-2 text-sm text-gray-700 leading-snug",children:s.note}),s.availableAgainAt&&e.jsxs("p",{className:"mt-2 text-xs text-gray-500",children:["Return ",w(s.availableAgainAt)]}),e.jsx("div",{className:"mt-2 text-[11px] uppercase tracking-wide text-gray-400",children:s.status||""})]},s.id)})]})]}),e.jsxs("section",{className:"bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden",children:[e.jsxs("button",{onClick:()=>o("Capabilities"),className:"w-full flex justify-between items-center px-5 py-3 text-left font-medium text-gray-900 hover:bg-gray-50",children:["Capabilities",r.includes("Capabilities")?e.jsx(f,{size:18}):e.jsx(j,{size:18})]}),r.includes("Capabilities")&&e.jsxs("div",{className:"px-5 py-4 border-t border-gray-100 space-y-4 text-sm text-gray-700",children:[e.jsxs("div",{className:"relative",children:[e.jsx(D,{size:16,className:"absolute left-3 top-3 text-gray-400"}),e.jsx("input",{type:"text",value:p,onChange:s=>v(s.target.value),placeholder:"Filter by skill, preference, or group…",className:"w-full rounded-md border border-gray-300 pl-9 pr-3 py-2 text-sm focus:outline-none focus:ring-1 focus:ring-[#0A4A7A]"})]}),e.jsx("div",{className:"border border-gray-200 rounded-lg overflow-hidden max-h-[280px] overflow-y-auto",children:e.jsxs("table",{className:"w-full text-sm text-gray-700",children:[e.jsx("thead",{className:"bg-gray-100 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left px-3 py-2",children:"Skill"}),e.jsx("th",{className:"text-left px-3 py-2",children:"Preference"}),e.jsx("th",{className:"text-left px-3 py-2",children:"Efficiency"}),e.jsx("th",{className:"text-left px-3 py-2",children:"Group"})]})}),e.jsx("tbody",{children:N.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center py-6 text-sm text-gray-500",children:"No matching capability entries."})}):N.map(s=>e.jsxs("tr",{className:"even:bg-gray-50",children:[e.jsx("td",{className:"px-3 py-2 font-medium text-gray-800",children:s.skill}),e.jsx("td",{className:"px-3 py-2",children:s.preference}),e.jsx("td",{className:"px-3 py-2",children:s.efficiency}),e.jsx("td",{className:"px-3 py-2",children:e.jsx("span",{className:`inline-flex items-center gap-1 rounded-full border px-2 py-0.5 text-xs font-semibold ${F(s.group)}`,children:s.group})})]},`${s.skill}-${s.group}`))})]})})]})]})]}),e.jsx("div",{className:"flex items-center justify-end px-6 py-3 border-t border-gray-200 bg-white",children:e.jsx("button",{onClick:g,className:"px-4 py-2 text-sm rounded-md border border-[#0A4A7A]/30 text-[#0A4A7A] hover:bg-[#0A4A7A]/10",children:"Close"})})]})})}function _(){const i=window.__POPUP_DATA__;if(!i)return e.jsx("div",{className:"p-10 text-center text-gray-500",children:"Loading popup…"});const t=i.mode==="tasks",m=t?i.tasks:[],r=t?null:i.resource,o=t?[]:i.history??[],[u,c]=n.useState(i.expanded??[]),[g,p]=n.useState(1);n.useEffect(()=>{const l=()=>{const A=window.innerHeight*.01;document.documentElement.style.setProperty("--vh",`${A}px`);const s=window.innerHeight,a=Math.max(.75,Math.min(1,s/900)),d=Number(a.toFixed(2));p(d),document.documentElement.style.setProperty("--ui-scale",String(a));const h=Math.max(13,Math.min(16,Math.round(s/60)));document.documentElement.style.fontSize=`${h}px`},x=document.body.style.margin,b=document.body.style.backgroundColor;return document.body.style.margin="0",document.body.style.backgroundColor="#F5F7FA",l(),window.addEventListener("resize",l),()=>{window.removeEventListener("resize",l),document.body.style.margin=x,document.body.style.backgroundColor=b}},[]);const v=n.useCallback(l=>{c(x=>x.includes(l)?x.filter(b=>b!==l):[...x,l])},[]),N=n.useCallback(()=>{c(["Work Details","Commitments / Customer / Location","Scheduling / Resources","Access Restrictions","Job Notes","Progress Notes","Closure"])},[]),y=n.useCallback(()=>{c([])},[]);return e.jsxs("div",{className:"min-h-screen w-screen overflow-hidden",style:{height:`calc(var(--vh, 1vh) * 100 / ${g})`,width:`${100/g}vw`,transform:`scale(${g})`,transformOrigin:"top left"},children:[t&&e.jsx(P,{open:!0,tasks:m,expanded:u,onToggleSection:v,onExpandAll:N,onCollapseAll:y,onClose:()=>{var l;return(l=window.__POPUP_CLOSE__)==null?void 0:l.call(window)}}),!t&&r&&e.jsx(M,{open:!0,resource:r,history:o,expanded:u,onToggleSection:v,onExpandAll:()=>{c(["Resource Summary","Availability","Callout History","Capabilities"])},onCollapseAll:y,onClose:()=>{var l;return(l=window.__POPUP_CLOSE__)==null?void 0:l.call(window)}})]})}S.createRoot(document.getElementById("popup-root")).render(e.jsx(_,{}));
